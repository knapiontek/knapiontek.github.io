<!DOCTYPE html>
<html>
<head>
<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.6.0/katex.min.css' integrity='sha384-wE+lCONuEo/QSfLb4AfrSk7HjWJtc4Xc1OiB2/aDBzHzjnlBP4SX7vjErTcwlA8C' crossorigin='anonymous'>
<link rel='stylesheet' href='common.css'>
<script src='https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.6.0/katex.min.js' integrity='sha384-tdtuPw3yx/rnUGmnLNWXtfjb9fpmwexsd+lr6HUYnUY4B7JhB5Ty7a1mYd+kto/s' crossorigin='anonymous'></script>
<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js'></script>
<script src='util.js'></script>
<meta http-equiv='Content-Type' content='text/html; charset=UTF-8' />
<style>
#simulation {
    position: relative;

    width: 100%;
    margin-left: auto;
    margin-right: auto;
    display: block;
    border: thin solid;
}
</style>
</head>
<body>
<div id='main_page'>

<h4>Poisson Equation</h4>
<div class='math'>
\nabla^2u = -f
</div>

<p>Matrix equation example for 5-steps with boundraries <b class='inmath'>u_0 \rightarrow c_0, u_6  \rightarrow c_6</b> and uniform <i>h</i></p>
<div class='math'>
\begin{bmatrix}
2 & -1 & 0 & 0 & 0 \\
-1 & 2 & -1 & 0 & 0 \\
0 & -1 & 2 & -1 & 0 \\
0 & 0 & -1 & 2 & -1 \\
0 & 0 & 0 & -1 & 2
\end{bmatrix}
\begin{bmatrix}
u_1 \\
u_2 \\
u_3 \\
u_4 \\
u_5
\end{bmatrix}
=h^2
\begin{bmatrix}
f_1 \\
f_2 \\
f_3 \\
f_4 \\
f_5
\end{bmatrix}
+
\begin{bmatrix}
c_0 \\
0 \\
0 \\
0 \\
c_6
\end{bmatrix}
</div>

<p>Integration by parts</p>
<div class='math'>
\int \frac{du}{dx}v = uv-\int u\frac{dv}{dx}
</div>

<h4>Numeric Example 1-Dimention</h4>
<div class='math'>
\frac{d^2y}{dx^2} = e^{-x^2}(4x^2 - 2)
</div>

<p>First integral</p>
<div class='math'>
c_1 = 0
</div>
<div class='math'>
\begin{cases}
u=e^{-x^2} \Rightarrow \frac{du}{dx} = -2xe^{-x^2} \Rightarrow du=-2xe^{-x^2}dx \\
v=-2x
\end{cases}
</div>

<div class='math'>
\begin{aligned}
\frac{dy}{dx} &= \int e^{-x^2}(4x^2-2)dx \\
&= \int 4x^2e^{-x^2} - \int 2e^{-x^2}dx \\
&= -2xe^{-x^2} + \int 2e^{-x^2}dx - \int 2e^{-x^2}dx \\
&= -2xe^{-x^2}
\end{aligned}
</div>

<p>Second integral</p>
<div class='math'>
c_2 = 0
</div>
<div class='math'>
u=-x^2 \Rightarrow du=-2xdx
</div>

<div class='math'>
\begin{aligned}
y &= \int -2xe^{-x^2}dx \\
&= e^{-x^2} \\
\end{aligned}
</div>

<p>Simulation</p>
<p>Press [+] or [-] to change number of steps: <i id='steps'>steps</i></p>
<div id='simulation'></div>

</div>

<script>
function input(x) {
    return Math.pow(Math.E, -x*x)*(4*x*x-2)
}
function generate_matrix(steps, dx, shift) {
    var ma = Matrix(steps)
    var vb = Vector(steps)

    for(var i = 0; i < steps; i++) {
        ma.data[i][i] = -2.0
        if(i > 0) ma.data[i][i-1] = 1.0
        if(i < steps-1) ma.data[i][i+1] = 1.0

        vb.data[i] = dx*dx*input(i*dx - shift)
    }

    return [ma, vb]
}
var size = 1000
var canvas = Canvas('#simulation', size, size)
function run_calculation(steps) {
    canvas.erase()

    var scale_y = 280
    var scale_x = 150

    var margin = 10
    var x1 = margin
    var x2 = size - margin
    var xm = (x1 + x2) / 2
    var y1 = margin
    var y2 = size - margin
    var ym = (y1 + 0.8*y2) / 2

    var axis_path = canvas.Path({color:'black'})
    axis_path.pike_line(Point2D(xm, y2), Point2D(xm, y1))
    axis_path.pike_line(Point2D(x1, ym), Point2D(x2, ym))

    // actual solution
    function evaluate1(x) {
        var y = Math.pow(Math.E, -x*x)
        return Point2D(xm+scale_x*x, ym-scale_y*y)
    }
    var solid_path = canvas.Path({color:'red'})
    solid_path.move_to(evaluate1(-3))
    for(var x=-3; x<3; x+=0.1) {
        solid_path.line_to(evaluate1(x))
    }
    solid_path.stroke()

    // input f function
    function evaluate2(x) {
        var y = input(x)
        return Point2D(xm+scale_x*x, ym-scale_y*y)
    }
    var dash_path = canvas.Path({dash:[9,12], color:'grey'})
    dash_path.move_to(evaluate2(-3))
    for(var x=-3; x<3; x+=0.1) {
        dash_path.line_to(evaluate2(x))
    }
    dash_path.stroke()

    // finite difference method
    var shift = 3
    var dx = 2*shift / (steps-1)
    var [ma, vb] = generate_matrix(steps, dx, shift)
    var u = ma.lu(vb)

    function evaluate3(i) {
        console.assert(i < u.data.length)
        var x = i*dx - shift
        return Point2D(xm+scale_x*x, ym-scale_y*u.data[i])
    }
    var blue_path = canvas.Path({dash:[], color:'blue'})
    blue_path.move_to(evaluate3(0))
    for(var i = 1; i < steps; i++) {
        blue_path.line_to(evaluate3(i))
    }
    blue_path.stroke()
}
var steps = 8
run_calculation(steps)
render_katex()
$('#steps').text(steps)
$(window).keydown(function(event) {
    switch(event.which) {
        case 109:
            steps -= 1
            break
        case 107:
            steps += 1
            break
        default:
            return
    }
    if(steps < 5) {
        steps = 5
    }
    $('#steps').text(steps)
    run_calculation(steps)
})
</script>

</body>
</html>
