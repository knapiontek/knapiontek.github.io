<!DOCTYPE html>
<html>
<head>
<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.6.0/katex.min.css' integrity='sha384-wE+lCONuEo/QSfLb4AfrSk7HjWJtc4Xc1OiB2/aDBzHzjnlBP4SX7vjErTcwlA8C' crossorigin='anonymous'>
<link rel='stylesheet' href='common.css'>
<script src='https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.6.0/katex.min.js' integrity='sha384-tdtuPw3yx/rnUGmnLNWXtfjb9fpmwexsd+lr6HUYnUY4B7JhB5Ty7a1mYd+kto/s' crossorigin='anonymous'></script>
<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js'></script>
<script src='util.js'></script>
<meta http-equiv='Content-Type' content='text/html; charset=UTF-8' />
<style>
#system2 {
    position: relative;

    width: 70%;
    margin-left: auto;
    margin-right: auto;
    display: block;
    border: thin solid;
}
#system3 {
    position: relative;

    width: 70%;
    margin-left: auto;
    margin-right: auto;
    display: block;
    border: thin solid;
}
</style>
</head>
<body>
<div id='main_page'>

<h4>Consider 3 square polynomial equations</h4>
<div class='math'>
\begin{cases}
x_0(t) = a_0t^2 + b_0t + c_0 \\
x'_0(t) = 2a_0t + b_0
\end{cases}
\begin{cases}
x_1(t) = a_1t^2 + b_1t + c_1 \\
x'_1(t) = 2a_1t + b_1
\end{cases}
\begin{cases}
x_2(t) = a_2t^2 + b_2t + c_2 \\
x'_2(t) = 2a_2t + b_2
\end{cases}
</div>

<p>Let's evaluated them in points <b class='inmath'>t=0, t=1</b></p>
<div class='math'>
\begin{cases}
x_0(0) = c_0 \\
x'_0(0) = b_0 \\
x_0(1) = a_0 + b_0 + c_0 \\
x'_0(1) = 2a_0 + b_0
\end{cases}
\begin{cases}
x_1(0) = c_1 \\
x'_1(0) = b_1 \\
x_1(1) = a_1 + b_1 + c_1 \\
x'_1(1) = 2a_1 + b_1
\end{cases}
\begin{cases}
x_2(0) = c_2 \\
x'_2(0) = b_2 \\
x_2(1) = a_2 + b_2 + c_2 \\
x'_2(1) = 2a_2 + b_2
\end{cases}
</div>

<p>We add extra constraints to ensure continuity in the point of joining</p>
<div class='math'>
\begin{cases}
x'_0(1) = x'_1(0) \\
x'_1(1) = x'_2(0) \\
x'_2(1) = x'_0(0)
\end{cases}
</div>

<p>We can expand it for 3 fixed points <b class='inmath'>x_0, x_1, x_2</b></p>
<div class='math'>
\begin{cases}
2a_0 + b_0 = b_1 \\
x_1 = a_0 + b_0 + c_0 \\
x_0 = c_0 \\
2a_1 + b_1 = b_2 \\
x_2 = a_1 + b_1 + c_1 \\
x_1 = c_1 \\
2a_2 + b_2 = b_0 \\
x_0 = a_2 + b_2 + c_2 \\
x_2 = c_2
\end{cases}
</div>

<p>In the matrix notation</p>
<div class='math'>
\begin{bmatrix}
2 & 1 & 0 & 0 & -1 & 0 & 0 & 0 & 0 \\
1 & 1 & 1 & 0 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 & 1 & 0 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 2 & 1 & 0 & 0 & -1 & 0 \\
0 & 0 & 0 & 1 & 1 & 1 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 \\
0 & -1 & 0 & 0 & 0 & 0 & 2 & 1 & 0 \\
0 & 0 & 0 & 0 & 0 & 0 & 1 & 1 & 1 \\
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1
\end{bmatrix}
\begin{bmatrix}
a_0 \\ b_0 \\ c_0 \\ a_1 \\ b_1 \\ c_1 \\ a_2 \\ b_2 \\ c_2
\end{bmatrix}
=
\begin{bmatrix}
0 \\ x_1 \\ x_0 \\ 0 \\ x_2 \\ x_1 \\ 0 \\ x_0 \\ x_2
\end{bmatrix}
</div>

<p>Finally the result</p>
<div id='system2'></div>

<h4>Consider 3 cubic polynomial equations</h4>
<div class='math'>
\begin{cases}
x_0(t) = a_0t^3 + b_0t^2 + c_0t + d_0 \\
x'_0(t) = 3a_0t^2 + 2b_0t + c_0 \\
x''_0(t) = 6a_0t + 2b_0
\end{cases}
\begin{cases}
x_1(t) = a_1t^3 + b_1t^2 + c_1t + d_1 \\
x'_1(t) = 3a_1t^2 + 2b_1t + c_1 \\
x''_1(t) = 6a_1t + 2b_1
\end{cases}
\begin{cases}
x_2(t) = a_2t^3 + b_2t^2 + c_2t + d_2 \\
x'_2(t) = 3a_2t^2 + 2b_2t + c_2 \\
x''_2(t) = 6a_2t + 2b_2
\end{cases}
</div>

<p>Let's evaluated them in points <b class='inmath'>t=0, t=1</b></p>
<div class='math'>
\begin{cases}
x_0(0) = d_0 \\
x'_0(0) = c_0 \\
x''_0(0) = 2b_0 \\
x_0(1) = a_0 + b_0 + c_0 + d_0 \\
x'_0(1) = 3a_0 + 2b_0 + c_0 \\
x''_0(1) = 6a_0 + 2b_0
\end{cases}
\begin{cases}
x_1(0) = d_1 \\
x'_1(0) = c_1 \\
x''_1(0) = 2b_1 \\
x_1(1) = a_1 + b_1 + c_1 + d_1 \\
x'_1(1) = 3a_1 + 2b_1 + c_1 \\
x''_1(1) = 6a_1 + 2b_1
\end{cases}
\begin{cases}
x_2(0) = d_2 \\
x'_2(0) = c_2 \\
x''_2(0) = 2b_2 \\
x_2(1) = a_2 + b_2 + c_2 + d_2 \\
x'_2(1) = 3a_2 + 2b_2 + c_2 \\
x''_2(1) = 6a_2 + 2b_2
\end{cases}
</div>

<p>We add extra constraints to ensure continuity in the point of joining</p>
<div class='math'>
\begin{cases}
x'_0(1) = x'_1(0) \\
x''_0(1) = x''_1(0) \\
x'_1(1) = x'_2(0) \\
x''_1(1) = x''_2(0) \\
x'_2(1) = x'_0(0) \\
x''_2(1) = x''_0(0)
\end{cases}
</div>

<p>We can expand it for 3 fixed points <b class='inmath'>x_0, x_1, x_2</b></p>
<div class='math'>
\begin{cases}
6a_0 + 2b_0 = 2b_1 \\
3a_0 + 2b_0 + c_0 = c_1 \\
x_1 = a_0 + b_0 + c_0 + d_0 \\
x_0 = d_0 \\
6a_1 + 2b_1 = 2b_2 \\
3a_1 + 2b_1 + c_1 = c_2 \\
x_2 = a_1 + b_1 + c_1 + d_1 \\
x_1 = d_1 \\
6a_2 + 2b_2 = 2b_0 \\
3a_2 + 2b_2 + c_2 = c_0 \\
x_0 = a_2 + b_2 + c_2 + d_2 \\
x_2 = d_2
\end{cases}
</div>

<p>In the matrix notation</p>
<div class='math'>
\begin{bmatrix}
6 & 2 & 0 & 0 & 0 & -2 & 0 & 0 & 0 & 0 & 0 & 0 \\
3 & 2 & 1 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 \\
1 & 1 & 1 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 6 & 2 & 0 & 0 & 0 & -2 & 0 & 0 \\
0 & 0 & 0 & 0 & 3 & 2 & 1 & 0 & 0 & 0 & -1 & 0 \\
0 & 0 & 0 & 0 & 1 & 1 & 1 & 1 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 \\
0 & -2 & 0 & 0 & 0 & 0 & 0 & 0 & 6 & 2 & 0 & 0 \\
0 & 0 & -1 & 0 & 0 & 0 & 0 & 0 & 3 & 2 & 1 & 0 \\
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 1 & 1 & 1 \\
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1
\end{bmatrix}
\begin{bmatrix}
a_0 \\ b_0 \\ c_0 \\ d_0 \\ a_1 \\ b_1 \\ c_1 \\ d_1 \\ a_2 \\ b_2 \\ c_2 \\ d_2
\end{bmatrix}
=
\begin{bmatrix}
0 \\ 0 \\ x_1 \\ x_0 \\ 0 \\ 0 \\ x_2 \\ x_1 \\ 0 \\ 0 \\ x_0 \\ x_2
\end{bmatrix}
</div>

<p>Finally the result</p>
<div id='system3'></div>

<h4>Conclusion</h4>
<li>The square polynomials require less coefficients and are generally faster to compute.</li>
<li>The cubic polynomials are more flexible and require less fixed points to sketch required curve.</li>
<li>System of equations can be avoided if one can fix derivatives of first polynomial. We cannot do it here because we draw closed loops.</li>
<li>No real winner here.</li>

<script>
function generate_matrix2(data) {
    var size = 3 * data.length
    var ma = Matrix(size)
    var vbx = Vector(size)
    var vby = Vector(size)

    for(var i = 0; i < data.length; i++) {
        var j = 3 * i

        ma.data[j+0][j+0] = 2.0
        ma.data[j+0][j+1] = 1.0
        ma.data[j+0][(j+4)%size] = -1.0
        ma.data[j+1][j+0] = 1.0
        ma.data[j+1][j+1] = 1.0
        ma.data[j+1][j+2] = 1.0
        ma.data[j+2][j+2] = 1.0

        vbx.data[j+2] = data[i].x
        vbx.data[(j-2+size)%size] = data[i].x

        vby.data[j+2] = data[i].y
        vby.data[(j-2+size)%size] = data[i].y
    }

    return [ma, vbx, vby]
}
function render_spline2() {
    var data = [
        Point2D(300.0, 300.0),
        Point2D(200.0, 200.0),
        Point2D(400.0, 450.0),
        Point2D(600.0, 800.0),
        Point2D(600.0, 600.0)
    ]

    var size = 1000
    var canvas = Canvas('#system2', size, size)

    var style = {fill_color: 'blue'}
    for(var i = 0; i < data.length; i++) {
        canvas.dot(data[i], 5, style)
    }

    var [ma, vbx, vby] = generate_matrix2(data)
    var vux = ma.lu(vbx)
    var vuy = ma.lu(vby)

    var vex = ma.mul(vux)
    var vey = ma.mul(vuy)
    console.assert(vex.norm2(vbx) < 0.001)
    console.assert(vey.norm2(vby) < 0.001)
    
    var path = canvas.Path({stroke_color: 'black'})
    path.move_to(data[0])
    for(var i = 0; i < data.length; i++) {
        var j = 3 * i
        var ax = vux.data[j+0]
        var bx = vux.data[j+1]
        var cx = vux.data[j+2]
        var ay = vuy.data[j+0]
        var by = vuy.data[j+1]
        var cy = vuy.data[j+2]
        for(var t = 0; t < 1; t += 0.05) {
            var x = (ax*t*t) + (bx*t) + cx
            var y = (ay*t*t) + (by*t) + cy
            path.line_to(Point2D(x, y))
        }
        path.line_to(data[(i+1)%data.length])
    }
    path.stroke()
}
function generate_matrix3(data) {
    var size = 4 * data.length
    var ma = Matrix(size)
    var vbx = Vector(size)
    var vby = Vector(size)

    for(var i = 0; i < data.length; i++) {
        var j = 4 * i

        ma.data[j+0][j+0] = 6.0
        ma.data[j+0][j+1] = 2.0
        ma.data[j+0][(j+5)%size] = -2.0
        ma.data[j+1][j+0] = 3.0
        ma.data[j+1][j+1] = 2.0
        ma.data[j+1][j+2] = 1.0
        ma.data[j+1][(j+6)%size] = -1.0
        ma.data[j+2][j+0] = 1.0
        ma.data[j+2][j+1] = 1.0
        ma.data[j+2][j+2] = 1.0
        ma.data[j+2][j+3] = 1.0
        ma.data[j+3][j+3] = 1.0

        vbx.data[j+3] = data[i].x
        vbx.data[(j-2+size)%size] = data[i].x

        vby.data[j+3] = data[i].y
        vby.data[(j-2+size)%size] = data[i].y
    }

    return [ma, vbx, vby]
}
function render_spline3() {
    var data = [
        Point2D(300.0, 600.0),
        Point2D(200.0, 200.0),
        Point2D(400.0, 250.0),
        Point2D(800.0, 200.0),
        Point2D(600.0, 600.0)
    ]

    var size = 1000
    var canvas = Canvas('#system3', size, size)

    var style = {fill_color: 'blue'}
    for(var i = 0; i < data.length; i++) {
        canvas.dot(data[i], 5, style)
    }

    var [ma, vbx, vby] = generate_matrix3(data)
    var vux = ma.lu(vbx)
    var vuy = ma.lu(vby)

    var vex = ma.mul(vux)
    var vey = ma.mul(vuy)
    console.assert(vex.norm2(vbx) < 0.001)
    console.assert(vey.norm2(vby) < 0.001)
    
    var path = canvas.Path({stroke_color: 'black'})
    path.move_to(data[0])
    for(var i = 0; i < data.length; i++) {
        var j = 4 * i
        var ax = vux.data[j+0]
        var bx = vux.data[j+1]
        var cx = vux.data[j+2]
        var dx = vux.data[j+3]
        var ay = vuy.data[j+0]
        var by = vuy.data[j+1]
        var cy = vuy.data[j+2]
        var dy = vuy.data[j+3]
        for(var t = 0; t < 1; t += 0.05) {
            var x = (ax*t*t*t) + (bx*t*t) + (cx*t) + dx
            var y = (ay*t*t*t) + (by*t*t) + (cy*t) + dy
            path.line_to(Point2D(x, y))
        }
        path.line_to(data[(i+1)%data.length])
    }
    path.stroke()
}
render_spline2()
render_spline3()
render_katex()
</script>
</body>
</html>
