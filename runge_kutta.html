<!DOCTYPE html>
<html>
<head>
<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.6.0/katex.min.css' integrity='sha384-wE+lCONuEo/QSfLb4AfrSk7HjWJtc4Xc1OiB2/aDBzHzjnlBP4SX7vjErTcwlA8C' crossorigin='anonymous'>
<script src='https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.6.0/katex.min.js' integrity='sha384-tdtuPw3yx/rnUGmnLNWXtfjb9fpmwexsd+lr6HUYnUY4B7JhB5Ty7a1mYd+kto/s' crossorigin='anonymous'></script>
<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js'></script>
<script src='common.js'></script>
<meta http-equiv='Content-Type' content='text/html; charset=UTF-8' />
<style>
#main_page {
    padding: 2cm;
    width: 19cm;
    margin-left: auto;
    margin-right: auto;
    background-color: #ffffff;
    box-shadow: 10px 10px 5px #888888;
}
body {
    background-color: #cccccc;
    font: 14px Myriad,Helvetica,Tahoma,Arial,clean,sans-serif;
    font-size: 0.8em;
    line-height: 1.5em;
    margin-top: 1.5em;
    margin-bottom: 1.5em;
}
#system {
    width: 100%;
    margin: 0 auto;
    border: thin solid;
}
</style>
</head>
<body>
<div id='main_page'>

<h4>Runge-Kutta Second Order</h4>
<div class='math'>
e^{i\omega} = \cos\omega + i\sin\omega
</div>

<h4>Numeric example</h4>
<div class='math'>
y'' + 2y' + 65y = \cos 2t
</div>
<h4>Expected Solution</h4>
<div class='math'>
a \cos 2t + b\sin 2t
</div>
<h4>Let's search for coefficients by substituting expected solution to the example</h4>
<div class='math'>
\begin{matrix}
(a\cos 2t + b\sin 2t)'' + 2(a\cos 2t + b\sin 2t)' + 65(a\cos 2t + b\sin 2t) = \cos 2t \\
(a\cos 2t + b\sin 2t)'' + (2a\cos 2t + 2b\sin 2t)' + 65a\cos 2t + 65b\sin 2t = \cos 2t \\
(-2a\sin 2t + 2b\cos 2t)' - 4a\sin 2t + 4b\cos 2t + 65a\cos 2t + 65b\sin 2t = \cos 2t \\
-4a\cos 2t - 4b\sin 2t - 4a\sin 2t + 4b\cos 2t + 65a\cos 2t + 65b\sin 2t = \cos 2t
\end{matrix}
</div>
<div class='math'>
\begin{cases}
 - 4b - 4a + 65b = 0 \\
-4a + 4b + 65a - 1 = 0
\end{cases}
</div>
<div class='math'>
\begin{cases}
4a = -61b \\
4b = 1 - 61a
\end{cases}
</div>
<div class='math'>
\begin{cases}
a = -\frac{61b}{4} \\
b = \frac{1 - 61a}{4}
\end{cases}
</div>

<p>Lets compare analytical solution with numerical method</p>

<p>Order reduction</p>
<div class='math'>
\begin{cases}
y' = x \\
x' + 2x + 65y = \cos 2t
\end{cases}
</div>

<p>Approximation by Euler method <b class='inmath'>\mathcal{O}(\Delta t)</b></p>
<div class='math'>
\begin{cases}
\frac{\Delta y}{\Delta t} = x \\
\\
\frac{\Delta x}{\Delta t} = -2x - 65y
\end{cases}
</div>

<p>Recursive algorithm</p>
<div class='math'>
\begin{cases}
y_{n+1} = y_n + x_n \Delta t \\
x_{n+1} = x_n - 2x_n \Delta t - 65y_{n+1} \Delta t
\end{cases}
</div>

<p>Simulation</p>
<p>Press [+] or [-] to change <i class='inmath'>\Delta t=</i><i id='step'>step</i></p>
<div><canvas id='system'></div>

<p>Remark</p>
<ul>
<li>The solution is very <i>smooth</i> therefore the first order approximation produces satisfying results. I had to set <b class='inmath'>\Delta t=0.03</b> to make the difference visible.</li>
</ul>


</div>

<script>
function run_calculation(step) {
    var size = 1000
    var system = $('#system').get(0)
    var context = system.getContext('2d')
    system.width = size
    system.height = size / 2
    context.clearRect(0, 0, size, size)

	context.beginPath()
	var margin = 10
	arrow(context, point(margin, size/2-margin), point(margin, margin))
	arrow(context, point(margin, size/4-margin), point(size-margin, size/4-margin))

	var c = 0.7
	var alpha = -1.0
	var beta = 8.0
	var scale = 300
	var dt = (size-2*margin) / scale

	context.moveTo(margin, size/4-scale*c-margin)
	for(t = 0; t < size-2*margin; t+=dt) {
		var y = c * Math.pow(Math.E, alpha*t/scale) * Math.cos(beta*t/scale)
		context.lineTo(t+margin, size/4-scale*y-margin)
	}
	context.stroke()

	var x = -0.7 // 1-st derivative at 0
	var y = 0.7 // function value at 0
	var dt = step

	context.setLineDash([5, 3])
	context.moveTo(margin, size/4-scale*c-margin)
	for(t = 0; t < size-2*margin; t+=scale*dt) {
		y = y + x*dt
		x = x - 2*x*dt - 65*y*dt
		context.lineTo(t+margin, size/4-scale*y-margin)
	}
	context.stroke()
}
var step = 0.03
run_calculation(step)
render_katex()
$('#step').text(step)
$(window).keydown(function(event) {
	switch(event.which) {
		case 109:
			step-=0.001
			break
		case 107:
			step+=0.001
			break
		default:
			return
	}
	if(step < 0.001) {
		step = 0.001
	}
	$('#step').text(step)
	run_calculation(step)
})
</script>

</body>
</html>
